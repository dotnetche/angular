<!-- Header Breadcrumb -->
<div class="bg-white shadow-sm border-b px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
  <div class="flex items-center space-x-4">
    <span class="text-gray-600">Изхранване</span>
    @if (showAddForm) {
      <span class="text-gray-400">/ {{ isEditing ? 'Редактиране' : 'Добавяне' }}</span>
    }
  </div>
</div>

<!-- Main Content -->
<div class="p-4 sm:p-6 lg:p-8 max-w-full">
  @if (showAddForm) {
    <div class="bg-white rounded-lg shadow-sm border max-w-4xl mx-auto">
      <div class="px-4 sm:px-6 lg:px-8 py-6 border-b">
        <h2 class="text-xl font-semibold text-gray-800">
          {{ isEditing ? 'Редактиране на тип изхранване' : 'Добави тип изхранване' }}
        </h2>
      </div>
      
      <form [formGroup]="feedingTypeForm" class="p-4 sm:p-6 lg:p-8 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          
          <mat-form-field class="w-full">
            <mat-label>Код</mat-label>
            <input matInput formControlName="code" placeholder="Въведете код (напр. BB, HB, FB)">
            <mat-error>{{ getErrorMessage('code') }}</mat-error>
          </mat-form-field>

          
          <mat-form-field class="w-full">
            <mat-label>Име</mat-label>
            <input matInput formControlName="name" placeholder="Въведете име на типа изхранване">
            <mat-error>{{ getErrorMessage('name') }}</mat-error>
          </mat-form-field>
        </div>

        
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 pt-4">
          <button 
            mat-raised-button 
            color="primary" 
            type="button"
            (click)="saveFeedingType()"
            [disabled]="!feedingTypeForm.valid || isLoading"
            class="bg-gray-600 hover:bg-gray-700 w-full sm:w-auto">
            {{ isEditing ? 'Обнови' : 'Добави' }}
          </button>
          
          @if (!isEditing) {
            <button 
              mat-raised-button 
              type="button"
              (click)="saveAndAddAnother()"
              [disabled]="!feedingTypeForm.valid || isLoading"
              class="bg-gray-500 hover:bg-gray-600 text-white w-full sm:w-auto">
              Добави и добави друг
            </button>
          }
          
          <button 
            mat-button 
            type="button"
            (click)="cancelForm()"
            class="text-gray-600 hover:text-gray-800 w-full sm:w-auto">
            Отказ
          </button>
        </div>
      </form>
    </div>
  }

  @if (!showAddForm) {
    
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
      <h1 class="text-2xl font-bold text-gray-800">Изхранване</h1>
      <button 
        mat-raised-button 
        color="primary"
        (click)="showAddFeedingTypeForm()"
        class="bg-gray-600 hover:bg-gray-700 w-full sm:w-auto">
        <mat-icon class="mr-2">add</mat-icon>
        Добави тип изхранване
      </button>
    </div>

    
    <div class="bg-white rounded-lg shadow-sm border mb-6">
      <div class="p-4 sm:p-6">
        <form [formGroup]="searchForm" class="flex items-center space-x-4">
          <mat-form-field class="flex-1">
            <mat-label>Търсене</mat-label>
            <input matInput formControlName="searchTerm" placeholder="Търсене по код или име">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </form>
      </div>
    </div>

    
    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
      <div class="overflow-x-auto">
        <div class="min-w-max">
          <mat-table [dataSource]="dataSource" class="w-full min-w-max">
          
          <ng-container matColumnDef="select">
            <mat-header-cell *matHeaderCellDef class="!w-12 !min-w-[48px] !max-w-[48px] !flex-shrink-0 !sticky !left-0 !bg-gray-50 !z-20 !border-r !border-gray-200">
              <mat-checkbox 
                (change)="$event ? masterToggle() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()">
              </mat-checkbox>
            </mat-header-cell>
            <mat-cell *matCellDef="let row" class="!w-12 !min-w-[48px] !max-w-[48px] !flex-shrink-0 !sticky !left-0 !bg-white !z-20 !border-r !border-gray-100">
              <mat-checkbox 
                (click)="$event.stopPropagation()"
                (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)">
              </mat-checkbox>
            </mat-cell>
          </ng-container>

          
          <ng-container matColumnDef="code">
            <mat-header-cell *matHeaderCellDef class="!font-semibold !min-w-[100px] !max-w-[150px] !px-4 !whitespace-nowrap">Код</mat-header-cell>
            <mat-cell *matCellDef="let feedingType" class="!font-mono !font-medium !text-blue-600 !min-w-[100px] !max-w-[150px] !px-4">
              <div class="truncate" [title]="feedingType.code">{{ feedingType.code }}</div>
            </mat-cell>
          </ng-container>

          
          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef class="!font-semibold !min-w-[200px] !max-w-[300px] !px-4 !whitespace-nowrap">Име</mat-header-cell>
            <mat-cell *matCellDef="let feedingType" class="!font-medium !min-w-[200px] !max-w-[300px] !px-4">
              <div class="truncate" [title]="feedingType.name">{{ feedingType.name }}</div>
            </mat-cell>
          </ng-container>

          
          <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef class="!w-32 !min-w-[120px] !max-w-[120px] !text-right !sticky !right-0 !bg-gray-50 !z-10 !border-l !border-gray-200"></mat-header-cell>
            <mat-cell *matCellDef="let feedingType" class="!w-32 !min-w-[120px] !max-w-[120px] !sticky !right-0 !bg-white !z-10 !border-l !border-gray-100">
              <div class="flex space-x-1">
                <button 
                  mat-icon-button 
                  (click)="editFeedingType(feedingType)"
                  class="text-gray-600 hover:text-blue-600"
                  matTooltip="Преглед">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button 
                  mat-icon-button 
                  (click)="editFeedingType(feedingType)"
                  class="text-gray-600 hover:text-green-600"
                  matTooltip="Редактиране">
                  <mat-icon>edit</mat-icon>
                </button>
                <button 
                  mat-icon-button 
                  (click)="deleteFeedingType(feedingType)"
                  class="text-gray-600 hover:text-red-600"
                  matTooltip="Изтриване">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50 cursor-pointer"></mat-row>
        </mat-table>
        </div>
      </div>
      </div>

      
      @if (isLoading) {
        <div class="flex justify-center items-center py-8">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      }

      
      @if (!isLoading && dataSource.data.length === 0) {
        <div class="text-center py-12 px-4">
          <mat-icon class="text-gray-400 text-6xl mb-4">storage</mat-icon>
          <h3 class="text-lg font-medium text-gray-600 mb-2">Няма намерени типове изхранване</h3>
          <p class="text-gray-500 mb-4">Започнете като добавите първия си тип изхранване</p>
          <button 
            mat-raised-button 
            color="primary"
            (click)="showAddFeedingTypeForm()"
            class="bg-gray-600 hover:bg-gray-700">
            Добави тип изхранване
          </button>
        </div>
      }

      
      <div class="border-t bg-gray-50 px-4 sm:px-6 py-3">
        <div class="flex flex-col sm:flex-row items-center justify-between space-y-2 sm:space-y-0">
          <div class="text-sm text-gray-600">
            От {{ getStartRecord() }} до {{ getEndRecord() }} от {{ totalCount }} резултата
          </div>
          
          <mat-paginator
            [length]="totalCount"
            [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions"
            [pageIndex]="currentPage"
            (page)="onPageChange($event)"
            showFirstLastButtons>
          </mat-paginator>
        </div>
      </div>
    
  }
</div>