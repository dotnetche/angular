<!-- Header Breadcrumb -->
<div class="bg-white shadow-sm border-b px-8 py-4 flex justify-between items-center">
  <div class="flex items-center space-x-4">
    <span class="text-gray-600">Хотели</span>
    @if (showAddForm) {
      <span class="text-gray-400">/ {{ isEditing ? 'Редактиране' : 'Добавяне' }}</span>
    }
  </div>
</div>

<!-- Main Content -->
@if (showAddForm) {
  <div class="bg-white m-8 rounded-lg shadow-sm border">
    <div class="px-8 py-6 border-b">
      <h2 class="text-xl font-semibold text-gray-800">
        {{ isEditing ? 'Редактиране на хотел' : 'Добави хотел' }}
      </h2>
    </div>
    
    <form [formGroup]="hotelForm" class="p-8 space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <mat-form-field class="w-full">
          <mat-label>Име на хотел</mat-label>
          <input matInput formControlName="name" placeholder="Въведете име на хотела">
          <mat-error>{{ getErrorMessage('name') }}</mat-error>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Категория (звезди)</mat-label>
          <mat-select formControlName="stars">
            <mat-option [value]="null">Без категория</mat-option>
            <mat-option *ngFor="let star of starsOptions" [value]="star">
              {{ getStarsDisplay(star) }} ({{ star }} звезди)
            </mat-option>
          </mat-select>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Локация</mat-label>
          <mat-select formControlName="locationId">
            <mat-option [value]="null">Изберете локация</mat-option>
            <mat-option *ngFor="let location of locations" [value]="location.id">
              {{ location.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Партньор</mat-label>
          <mat-select formControlName="partnerId">
            <mat-option [value]="null">Изберете партньор</mat-option>
            <mat-option *ngFor="let partner of partners" [value]="partner.id">
              {{ partner.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      
      <mat-form-field class="w-full">
        <mat-label>Контакти</mat-label>
        <textarea matInput formControlName="contacts" rows="3" placeholder="Въведете контактна информация"></textarea>
        <mat-error>{{ getErrorMessage('contacts') }}</mat-error>
      </mat-form-field>

      
      <div class="flex items-center">
        <mat-slide-toggle formControlName="isTemporaryClosed" color="warn">
          Временно затворен
        </mat-slide-toggle>
      </div>

      
      <div class="flex space-x-4 pt-4">
        <button 
          mat-raised-button 
          color="primary" 
          type="button"
          (click)="saveHotel()"
          [disabled]="!hotelForm.valid || isLoading"
          class="bg-gray-600 hover:bg-gray-700">
          {{ isEditing ? 'Обнови' : 'Добави' }}
        </button>
        
        @if (!isEditing) {
          <button 
            mat-raised-button 
            type="button"
            (click)="saveAndAddAnother()"
            [disabled]="!hotelForm.valid || isLoading"
            class="bg-gray-500 hover:bg-gray-600 text-white">
            Добави и добави друг
          </button>
        }
        
        <button 
          mat-button 
          type="button"
          (click)="cancelForm()"
          class="text-gray-600 hover:text-gray-800">
          Отказ
        </button>
      </div>
    </form>
  </div>
}

@if (!showAddForm) {
  <div class="m-8">
    
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-800">Хотели</h1>
      <button 
        mat-raised-button 
        color="primary"
        (click)="showAddHotelForm()"
        class="bg-gray-600 hover:bg-gray-700">
        <mat-icon class="mr-2">add</mat-icon>
        Добави хотел
      </button>
    </div>

    
    <div class="bg-white rounded-lg shadow-sm border mb-6">
      <div class="p-6">
        <form [formGroup]="searchForm" class="flex items-center space-x-4">
          <mat-form-field class="flex-1">
            <mat-label>Търсене</mat-label>
            <input matInput formControlName="searchTerm" placeholder="Търсене по име, локация или партньор">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </form>
      </div>
    </div>

    
    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
      <mat-table [dataSource]="dataSource" class="w-full">
        
        <ng-container matColumnDef="select">
          <mat-header-cell *matHeaderCellDef class="w-12">
            <mat-checkbox 
              (change)="$event ? masterToggle() : null"
              [checked]="selection.hasValue() && isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()">
            </mat-checkbox>
          </mat-header-cell>
          <mat-cell *matCellDef="let row" class="w-12">
            <mat-checkbox 
              (click)="$event.stopPropagation()"
              (change)="$event ? selection.toggle(row) : null"
              [checked]="selection.isSelected(row)">
            </mat-checkbox>
          </mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="name">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Име на хотел</mat-header-cell>
          <mat-cell *matCellDef="let hotel" class="font-medium">{{ hotel.name }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="stars">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Категория</mat-header-cell>
          <mat-cell *matCellDef="let hotel" class="text-yellow-600">{{ getStarsDisplay(hotel.stars) }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="locationName">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Локация</mat-header-cell>
          <mat-cell *matCellDef="let hotel">{{ hotel.locationName || 'Не е указана' }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="partnerName">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Партньор</mat-header-cell>
          <mat-cell *matCellDef="let hotel">{{ hotel.partnerName || 'Не е указан' }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="contacts">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Контакти</mat-header-cell>
          <mat-cell *matCellDef="let hotel" class="max-w-xs truncate">{{ hotel.contacts }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="isTemporaryClosed">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Статус</mat-header-cell>
          <mat-cell *matCellDef="let hotel">
            <span [class]="hotel.isTemporaryClosed ? 'text-red-600 bg-red-100 px-2 py-1 rounded-full text-xs' : 'text-green-600 bg-green-100 px-2 py-1 rounded-full text-xs'">
              {{ getStatusDisplay(hotel.isTemporaryClosed) }}
            </span>
          </mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef class="w-32"></mat-header-cell>
          <mat-cell *matCellDef="let hotel" class="w-32">
            <div class="flex space-x-2">
              <button 
                mat-icon-button 
                (click)="editHotel(hotel)"
                class="text-gray-600 hover:text-blue-600"
                matTooltip="Преглед">
                <mat-icon>visibility</mat-icon>
              </button>
              <button 
                mat-icon-button 
                (click)="editHotel(hotel)"
                class="text-gray-600 hover:text-green-600"
                matTooltip="Редактиране">
                <mat-icon>edit</mat-icon>
              </button>
              <button 
                mat-icon-button 
                (click)="deleteHotel(hotel)"
                class="text-gray-600 hover:text-red-600"
                matTooltip="Изтриване">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50 cursor-pointer"></mat-row>
      </mat-table>

      
      @if (isLoading) {
        <div class="flex justify-center items-center py-8">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      }

      
      @if (!isLoading && dataSource.data.length === 0) {
        <div class="text-center py-12">
          <mat-icon class="text-gray-400 text-6xl mb-4">hotel</mat-icon>
          <h3 class="text-lg font-medium text-gray-600 mb-2">Няма намерени хотели</h3>
          <p class="text-gray-500 mb-4">Започнете като добавите първия си хотел</p>
          <button 
            mat-raised-button 
            color="primary"
            (click)="showAddHotelForm()"
            class="bg-gray-600 hover:bg-gray-700">
            Добави хотел
          </button>
        </div>
      }

      
      <div class="border-t bg-gray-50 px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-600">
            От {{ currentPage * pageSize + 1 }} до {{ math.min((currentPage + 1) * pageSize, totalCount) }} от {{ totalCount }} резултата
          </div>
          
          <mat-paginator
            [length]="totalCount"
            [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions"
            [pageIndex]="currentPage"
            (page)="onPageChange($event)"
            showFirstLastButtons>
          </mat-paginator>
        </div>
      </div>
    </div>
  </div>
}