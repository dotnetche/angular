<!-- Header Breadcrumb -->
<div class="bg-white shadow-sm border-b px-8 py-4 flex justify-between items-center">
  <div class="flex items-center space-x-4">
    <span class="text-gray-600">Стаи</span>
    @if (showAddForm) {
      <span class="text-gray-400">/ {{ isEditing ? 'Редактиране' : 'Добавяне' }}</span>
    }
  </div>
</div>

<!-- Main Content -->
@if (showAddForm) {
  <div class="bg-white m-8 rounded-lg shadow-sm border">
    <div class="px-8 py-6 border-b">
      <h2 class="text-xl font-semibold text-gray-800">
        {{ isEditing ? 'Редактиране на стая' : 'Добави стая' }}
      </h2>
    </div>
    
    <form [formGroup]="hotelRoomForm" class="p-8 space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <mat-form-field class="w-full">
          <mat-label>Име на стая</mat-label>
          <input matInput formControlName="name" placeholder="Въведете име на стаята">
          <mat-error>{{ getErrorMessage('name') }}</mat-error>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Хотел</mat-label>
          <mat-select formControlName="hotelId">
            <mat-option [value]="null">Изберете хотел</mat-option>
            <mat-option *ngFor="let hotel of hotels" [value]="hotel.id">
              {{ hotel.name }}
            </mat-option>
          </mat-select>
          <mat-error>{{ getErrorMessage('hotelId') }}</mat-error>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Цена (лв.)</mat-label>
          <input matInput formControlName="price" type="number" step="0.01" min="0" placeholder="0.00">
          <mat-error>{{ getErrorMessage('price') }}</mat-error>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Максимум възрастни</mat-label>
          <input matInput formControlName="maxAdults" type="number" min="0" placeholder="0">
          <mat-error>{{ getErrorMessage('maxAdults') }}</mat-error>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Максимум деца</mat-label>
          <input matInput formControlName="maxChildren" type="number" min="0" placeholder="0">
          <mat-error>{{ getErrorMessage('maxChildren') }}</mat-error>
        </mat-form-field>

        
        <mat-form-field class="w-full">
          <mat-label>Максимум бебета</mat-label>
          <input matInput formControlName="maxBabies" type="number" min="0" placeholder="0">
          <mat-error>{{ getErrorMessage('maxBabies') }}</mat-error>
        </mat-form-field>
      </div>

      
      <mat-form-field class="w-full">
        <mat-label>Описание</mat-label>
        <textarea matInput formControlName="description" rows="3" placeholder="Въведете описание на стаята"></textarea>
      </mat-form-field>

      
      <div class="flex space-x-4 pt-4">
        <button 
          mat-raised-button 
          color="primary" 
          type="button"
          (click)="saveHotelRoom()"
          [disabled]="!hotelRoomForm.valid || isLoading"
          class="bg-gray-600 hover:bg-gray-700">
          {{ isEditing ? 'Обнови' : 'Добави' }}
        </button>
        
        @if (!isEditing) {
          <button 
            mat-raised-button 
            type="button"
            (click)="saveAndAddAnother()"
            [disabled]="!hotelRoomForm.valid || isLoading"
            class="bg-gray-500 hover:bg-gray-600 text-white">
            Добави и добави друга
          </button>
        }
        
        <button 
          mat-button 
          type="button"
          (click)="cancelForm()"
          class="text-gray-600 hover:text-gray-800">
          Отказ
        </button>
      </div>
    </form>
  </div>
}

@if (!showAddForm) {
  <div class="m-8">
    
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-800">Стаи</h1>
      <button 
        mat-raised-button 
        color="primary"
        (click)="showAddHotelRoomForm()"
        class="bg-gray-600 hover:bg-gray-700">
        <mat-icon class="mr-2">add</mat-icon>
        Добави стая
      </button>
    </div>

    
    <div class="bg-white rounded-lg shadow-sm border mb-6">
      <div class="p-6">
        <form [formGroup]="searchForm" class="flex items-center space-x-4">
          <mat-form-field class="flex-1">
            <mat-label>Търсене</mat-label>
            <input matInput formControlName="searchTerm" placeholder="Търсене по име, хотел или описание">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </form>
      </div>
    </div>

    
    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
      <mat-table [dataSource]="dataSource" class="w-full">
        
        <ng-container matColumnDef="select">
          <mat-header-cell *matHeaderCellDef class="w-12">
            <mat-checkbox 
              (change)="$event ? masterToggle() : null"
              [checked]="selection.hasValue() && isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()">
            </mat-checkbox>
          </mat-header-cell>
          <mat-cell *matCellDef="let row" class="w-12">
            <mat-checkbox 
              (click)="$event.stopPropagation()"
              (change)="$event ? selection.toggle(row) : null"
              [checked]="selection.isSelected(row)">
            </mat-checkbox>
          </mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="name">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Име на стая</mat-header-cell>
          <mat-cell *matCellDef="let room" class="font-medium">{{ room.name }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="hotelName">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Хотел</mat-header-cell>
          <mat-cell *matCellDef="let room">{{ room.hotelName || 'Не е указан' }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="price">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Цена</mat-header-cell>
          <mat-cell *matCellDef="let room" class="text-green-600 font-medium">{{ formatPrice(room.price) }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="maxAdults">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Възрастни</mat-header-cell>
          <mat-cell *matCellDef="let room">{{ room.maxAdults || 0 }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="maxChildren">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Деца</mat-header-cell>
          <mat-cell *matCellDef="let room">{{ room.maxChildren || 0 }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="maxBabies">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Бебета</mat-header-cell>
          <mat-cell *matCellDef="let room">{{ room.maxBabies || 0 }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="description">
          <mat-header-cell *matHeaderCellDef class="font-semibold">Описание</mat-header-cell>
          <mat-cell *matCellDef="let room" class="max-w-xs truncate">{{ room.description || 'Няма описание' }}</mat-cell>
        </ng-container>

        
        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef class="w-32"></mat-header-cell>
          <mat-cell *matCellDef="let room" class="w-32">
            <div class="flex space-x-2">
              <button 
                mat-icon-button 
                (click)="editHotelRoom(room)"
                class="text-gray-600 hover:text-blue-600"
                matTooltip="Преглед">
                <mat-icon>visibility</mat-icon>
              </button>
              <button 
                mat-icon-button 
                (click)="editHotelRoom(room)"
                class="text-gray-600 hover:text-green-600"
                matTooltip="Редактиране">
                <mat-icon>edit</mat-icon>
              </button>
              <button 
                mat-icon-button 
                (click)="deleteHotelRoom(room)"
                class="text-gray-600 hover:text-red-600"
                matTooltip="Изтриване">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50 cursor-pointer"></mat-row>
      </mat-table>

      
      @if (isLoading) {
        <div class="flex justify-center items-center py-8">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      }

      
      @if (!isLoading && dataSource.data.length === 0) {
        <div class="text-center py-12">
          <mat-icon class="text-gray-400 text-6xl mb-4">settings</mat-icon>
          <h3 class="text-lg font-medium text-gray-600 mb-2">Няма намерени стаи</h3>
          <p class="text-gray-500 mb-4">Започнете като добавите първата си стая</p>
          <button 
            mat-raised-button 
            color="primary"
            (click)="showAddHotelRoomForm()"
            class="bg-gray-600 hover:bg-gray-700">
            Добави стая
          </button>
        </div>
      }

      
      <div class="border-t bg-gray-50 px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-600">
            От {{ currentPage * pageSize + 1 }} до {{ math.min((currentPage + 1) * pageSize, totalCount) }} от {{ totalCount }} резултата
          </div>
          
          <mat-paginator
            [length]="totalCount"
            [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions"
            [pageIndex]="currentPage"
            (page)="onPageChange($event)"
            showFirstLastButtons>
          </mat-paginator>
        </div>
      </div>
    </div>
  </div>
}